============================= test session starts ==============================
platform darwin -- Python 3.13.0, pytest-7.4.3, pluggy-1.6.0 -- /Users/will/Projects/fractal-goals/fractal-goals-venv/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/will/Projects/fractal-goals
configfile: pytest.ini
plugins: flask-1.3.0, black-0.3.12, anyio-4.12.0, Faker-20.1.0, cov-4.1.0, asyncio-0.21.1, flake8-1.1.1, requests-mock-1.11.0
asyncio: mode=Mode.STRICT
collecting ... collected 1 item

tests/integration/test_goals_api.py::TestGoalCRUDEndpoints::test_create_goal DEBUG: mock_get_engine called. URI: sqlite:////var/folders/cp/z9d7txd14rs6381w7m3fdt600000gn/T/tmpuc_hmo0o.db
âœ“ Loaded environment config: /Users/will/Projects/fractal-goals/.env.production
DEBUG: Creating goal of type LongTermGoal, parent_id: 50f9b143-149d-40dd-934f-787a156964e3
DEBUG: mock_get_engine called. URI: sqlite:////var/folders/cp/z9d7txd14rs6381w7m3fdt600000gn/T/tmpuc_hmo0o.db
DEBUG: Looking for parent with ID: 50f9b143-149d-40dd-934f-787a156964e3
FAILED

=================================== FAILURES ===================================
____________________ TestGoalCRUDEndpoints.test_create_goal ____________________

self = <test_goals_api.TestGoalCRUDEndpoints object at 0x1071f0e10>
client = <FlaskClient <Flask 'tests.conftest'>>
sample_ultimate_goal = <UltimateGoal(id=50f9b143-149d-40dd-934f-787a156964e3, name=Master Software Engineering)>

    def test_create_goal(self, client, sample_ultimate_goal):
        """Test creating a new goal."""
        payload = {
            'name': 'New Long Term Goal',
            'description': 'A new goal',
            'type': 'LongTermGoal',
            'parent_id': sample_ultimate_goal.id,
            'root_id': sample_ultimate_goal.id
        }
        response = client.post(
            '/api/goals',
            data=json.dumps(payload),
            content_type='application/json'
        )
>       assert response.status_code == 201
E       assert 404 == 201
E        +  where 404 = <WrapperTestResponse streamed [404 NOT FOUND]>.status_code

tests/integration/test_goals_api.py:114: AssertionError

---------- coverage: platform darwin, python 3.13.0-final-0 ----------
Name                                  Stmts   Miss  Cover   Missing
-------------------------------------------------------------------
app.py                                   33     33     0%   6-76
blueprints/__init__.py                    0      0   100%
blueprints/activities_api.py            237    214    10%   24-34, 39-67, 72-91, 96-115, 120-141, 150-160, 165-230, 235-369, 374-389
blueprints/goals_api.py                 351    300    15%   28-36, 62-102, 110-201, 207-244, 250-299, 306-339, 349-381, 387-421, 427-444, 450-462, 468-505, 511-531, 537-559, 565-601
blueprints/pages.py                      37     37     0%   6-97
blueprints/programs_api.py              352    352     0%   1-604
blueprints/sessions_api.py              311    282     9%   28-116, 125-161, 169-186, 195-213, 222-230, 235-248, 254-315, 321-397, 403-434, 443-470, 476-517, 523-549, 555-622
blueprints/templates_api.py              94     78    17%   24-36, 42-56, 62-96, 102-131, 137-157
blueprints/timers_api.py                143    129    10%   24-75, 80-141, 147-183, 190-264
config.py                                51     22    57%   24-29, 61, 67-72, 77-87
models.py                               299     76    75%   80-99, 156-213, 230, 262, 293, 315, 346-347, 379, 402, 426, 460, 487, 513, 540, 553, 558, 564-569, 572, 579, 583, 587-594, 600-603
tests/__init__.py                         0      0   100%
tests/conftest.py                       118     46    61%   99, 134-172, 183-193, 199-239, 245-257, 263-276, 282-303, 312-345
tests/integration/test_goals_api.py     139     98    29%   28-32, 36-49, 53-57, 61-67, 71-72, 81-88, 92-93, 115-118, 122-132, 136-148, 152-158, 162-168, 173-184, 194-208, 212-213, 222-234, 239-260, 270-284, 288-303, 314-318, 325-329
-------------------------------------------------------------------
TOTAL                                  2165   1667    23%
Coverage HTML written to dir htmlcov

FAIL Required test coverage of 80% not reached. Total coverage: 23.00%
=========================== short test summary info ============================
FAILED tests/integration/test_goals_api.py::TestGoalCRUDEndpoints::test_create_goal
============================== 1 failed in 0.30s ===============================
